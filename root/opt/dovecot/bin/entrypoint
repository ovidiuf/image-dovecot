#!/usr/bin/env bash

function main() {

    #
    # replace environment variables declared in the Dovecot configuration file. Dovecot does not do that
    #

    cat /opt/dovecot/conf/dovecot.conf | envsubst > /tmp/.tmp.txt
    mv /tmp/.tmp.txt /opt/dovecot/conf/dovecot.conf
    chown dovecot:dovecot /opt/dovecot/conf/dovecot.conf

    #
    # initialize log dir
    #

    [ -d /opt/dovecot/external/log ] || mkdir /opt/dovecot/external/log
    [ -d /opt/dovecot/external/ssl ] || mkdir /opt/dovecot/external/ssl
    [ -d /opt/dovecot/external/imap-data ] || mkdir /opt/dovecot/external/imap-data

    exec /opt/dovecot/bin/dovecot -F -c /opt/dovecot/conf/dovecot.conf
}

main "$@"
